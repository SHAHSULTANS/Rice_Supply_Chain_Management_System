{% extends "base.html" %} {% load static %} {% block content %}
<div class="container py-5 animate__animated animate__fadeIn">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="card shadow-lg border-0 rounded-lg">
        <!-- Card Header -->
        <div class="card-header bg-gradient-primary text-primary py-3">
          <div class="d-flex justify-content-between align-items-center">
            <h3 class="mb-0">
              <i class="fas fa-store-alt me-2"></i>Create Marketplace Listing
            </h3>
            <span class="badge bg-white text-primary"
              >From Stock #{{ paddy_stock.id }}</span
            >
          </div>
        </div>

        <!-- Card Body -->
        <div class="card-body">
          <form
            method="post"
            enctype="multipart/form-data"
            class="needs-validation"
            novalidate
          >
            {% csrf_token %}

            <!-- Stock Information Section -->
            <div class="mb-4 border-bottom pb-3">
              <h5 class="text-primary mb-3">
                <i class="fas fa-box-open me-2"></i>Stock Information
              </h5>
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="form-group">
                    <label class="form-label">Paddy Variety</label>
                    <div class="form-control bg-light">
                      {{ paddy_stock.name }}
                    </div>
                    <input
                      type="hidden"
                      name="paddy_stock"
                      value="{{ paddy_stock.id }}"
                    />
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-group">
                    <label class="form-label">Available Quantity</label>
                    <div class="input-group">
                      <div class="form-control bg-light text-end">
                        {{ paddy_stock.available_quantity|floatformat:2 }}
                      </div>
                      <span class="input-group-text">Mon</span>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-group">
                    <label class="form-label">Moisture Content</label>
                    <div class="input-group">
                      <div class="form-control bg-light text-end">
                        {{ paddy_stock.moisture_content|floatformat:1 }}
                      </div>
                      <span class="input-group-text">%</span>
                    </div>
                    <div class="form-text">
                      <span id="moisture-status">
                        {% if paddy_stock.moisture_content < 12 %}
                        <span class="text-success"
                          ><i class="fas fa-check-circle me-1"></i> Excellent
                          quality</span
                        >
                        {% elif paddy_stock.moisture_content < 14 %}
                        <span class="text-primary"
                          ><i class="fas fa-check me-1"></i> Good quality</span
                        >
                        {% else %}
                        <span class="text-warning"
                          ><i class="fas fa-exclamation-triangle me-1"></i> Fair
                          quality</span
                        >
                        {% endif %}
                      </span>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-group">
                    <label class="form-label">Current Price</label>
                    <div class="input-group">
                      <span class="input-group-text">৳</span>
                      <div class="form-control bg-light text-end">
                        {{ paddy_stock.price_per_mon|floatformat:2 }}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Listing Configuration -->
            <div class="mb-4 border-bottom pb-3">
              <h5 class="text-primary mb-3">
                <i class="fas fa-cog me-2"></i>Listing Configuration
              </h5>
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="form-group">
                    <label
                      for="{{ form.quantity.id_for_label }}"
                      class="form-label"
                    >
                      Quantity to Sell (Mon) <span class="text-danger">*</span>
                    </label>
                    <div class="input-group">
                      {{ form.quantity }}
                      <span class="input-group-text">Mon</span>
                    </div>
                    <div class="invalid-feedback">
                      Please enter a valid quantity (max {{
                      paddy_stock.available_quantity|floatformat:2 }} Mon)
                    </div>
                    <small class="text-muted">
                      Available: {{ paddy_stock.available_quantity|floatformat:2
                      }} Mon
                    </small>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-group">
                    <label
                      for="{{ form.price_per_mon.id_for_label }}"
                      class="form-label"
                    >
                      Listing Price per Mon (৳)
                      <span class="text-danger">*</span>
                    </label>
                    <div class="input-group">
                      <span class="input-group-text">৳</span>
                      {{ form.price_per_mon }}
                    </div>
                    <div class="invalid-feedback">
                      Please enter a valid price.
                    </div>
                    <div class="form-text">
                      <div class="d-flex justify-content-between">
                        <small
                          >Current: ৳{{ paddy_stock.price_per_mon|floatformat:2
                          }}</small
                        >
                        <small>Market: ৳1,200-1,400</small>
                      </div>
                      <div class="progress mt-1" style="height: 5px">
                        <div
                          class="progress-bar bg-success"
                          style="width: 25%"
                        ></div>
                        <div
                          class="progress-bar bg-warning"
                          style="width: 50%"
                        ></div>
                        <div
                          class="progress-bar bg-danger"
                          style="width: 25%"
                        ></div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-12">
                  <div class="form-group">
                    <label
                      for="{{ form.status.id_for_label }}"
                      class="form-label"
                    >
                      Listing Status
                    </label>
                    {{ form.status }}
                  </div>
                </div>
              </div>
            </div>

            <!-- Visual Elements -->
            <div class="mb-4 border-bottom pb-3">
              <h5 class="text-primary mb-3">
                <i class="fas fa-images me-2"></i>Product Image
              </h5>
              <div class="row">
                <div class="col-md-6">
                  <div class="current-image mb-3">
                    <label class="form-label">Current Image</label>
                    <div class="border rounded p-2 text-center">
                      {% if paddy_stock.image %}
                      <img
                        src="{{ paddy_stock.image.url }}"
                        class="img-fluid rounded"
                        style="max-height: 200px"
                      />
                      {% else %}
                      <div class="text-muted py-4">
                        <i class="fas fa-image fa-3x mb-2"></i>
                        <p>No image available</p>
                      </div>
                      {% endif %}
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-group">
                    <label
                      for="{{ form.image.id_for_label }}"
                      class="form-label"
                    >
                      Update Image
                    </label>
                    <div class="file-upload-wrapper">
                      <div class="image-upload-wrap" id="image-upload-wrap">
                        <input
                          type="file"
                          name="{{ form.image.name }}"
                          id="{{ form.image.id_for_label }}"
                          class="file-upload-input"
                          accept="image/*"
                          onchange="readURL(this);"
                        />
                        <div class="drag-text">
                          <div class="icon">
                            <i
                              class="fas fa-cloud-upload-alt fa-2x text-muted"
                            ></i>
                          </div>
                          <h6>Drag and drop or click to upload</h6>
                          <small>Recommended: 800x600px (max 2MB)</small>
                        </div>
                      </div>
                      <div
                        class="file-upload-content d-none"
                        id="file-upload-content"
                      >
                        <img
                          class="file-upload-image"
                          id="file-upload-image"
                          src="#"
                          alt="Preview"
                        />
                        <div class="image-title-wrap mt-2">
                          <button
                            type="button"
                            onclick="removeUpload()"
                            class="btn btn-danger btn-sm"
                          >
                            <i class="fas fa-times me-1"></i> Remove
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Quality Notes -->
            <div class="mb-4">
              <h5 class="text-primary mb-3">
                <i class="fas fa-clipboard-check me-2"></i>Quality Description
              </h5>
              <div class="form-group">
                <label
                  for="{{ form.quality_notes.id_for_label }}"
                  class="form-label"
                >
                  Additional Quality Notes
                </label>
                {{ form.quality_notes }}
                <div class="form-text">
                  Describe any special qualities, certifications, or handling
                  instructions
                </div>
              </div>
            </div>

            <!-- Form Actions -->
            <div class="d-flex justify-content-between mt-5">
              <a
                href="{% url 'dealer_dashboard' %}"
                class="btn btn-outline-secondary px-4"
              >
                <i class="fas fa-arrow-left me-2"></i> Cancel
              </a>
              <button type="submit" class="btn btn-primary px-4">
                <i class="fas fa-check-circle me-2"></i> Publish Listing
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block extra_css %}
<style>
  /* Animation and transition effects */
  .animate__animated {
    animation-duration: 0.5s;
  }

  /* File upload styling */
  .file-upload-wrapper {
    position: relative;
    margin-bottom: 1rem;
  }

  .image-upload-wrap {
    border: 2px dashed #ced4da;
    border-radius: 8px;
    padding: 30px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .image-upload-wrap:hover {
    border-color: #0d6efd;
    background-color: rgba(13, 110, 253, 0.05);
  }

  .drag-text h6 {
    margin-top: 10px;
    font-weight: 500;
  }

  .file-upload-input {
    position: absolute;
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    outline: none;
    opacity: 0;
    cursor: pointer;
  }

  .file-upload-image {
    max-height: 180px;
    max-width: 100%;
    margin: 0 auto;
    border-radius: 8px;
  }

  /* Current image box */
  .current-image .border {
    transition: all 0.3s ease;
  }
  .current-image .border:hover {
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  }

  /* Form control hover effects */
  .form-control:not(.bg-light):hover {
    border-color: #86b7fe;
  }

  /* Button hover effects */
  .btn-outline-secondary:hover {
    transform: translateY(-1px);
  }
  .btn-primary:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(13, 110, 253, 0.2);
  }

  /* Badge animation */
  .badge {
    transition: all 0.3s ease;
  }
  .badge:hover {
    transform: scale(1.05);
  }
</style>
{% endblock %} {% block extra_js %}
<script>
  $(document).ready(function () {
    // Image upload preview
    function readURL(input) {
      if (input.files && input.files[0]) {
        const reader = new FileReader();

        reader.onload = function (e) {
          $("#image-upload-wrap").addClass("d-none");
          $("#file-upload-content").removeClass("d-none");
          $("#file-upload-image").attr("src", e.target.result);
        };

        reader.readAsDataURL(input.files[0]);
      }
    }

    function removeUpload() {
      $("#file-upload-input").val("");
      $("#file-upload-content").addClass("d-none");
      $("#image-upload-wrap").removeClass("d-none");
    }

    // Quantity validation
    $("#{{ form.quantity.id_for_label }}").on("input", function () {
      const maxQty = parseFloat("{{ paddy_stock.available_quantity }}") || 0;
      const enteredQty = parseFloat($(this).val()) || 0;

      if (enteredQty > maxQty) {
        $(this).addClass("is-invalid");
      } else {
        $(this).removeClass("is-invalid");
      }
    });

    // Price suggestion
    $("#{{ form.price_per_mon.id_for_label }}").on("focus", function () {
      if (!$(this).val()) {
        $(this).val("{{ paddy_stock.price_per_mon|floatformat:2 }}");
      }
    });

    // Form validation
    (function () {
      "use strict";

      // Fetch all the forms we want to apply custom Bootstrap validation styles to
      const forms = document.querySelectorAll(".needs-validation");

      // Loop over them and prevent submission
      Array.from(forms).forEach((form) => {
        form.addEventListener(
          "submit",
          (event) => {
            if (!form.checkValidity()) {
              event.preventDefault();
              event.stopPropagation();
            }

            form.classList.add("was-validated");
          },
          false
        );
      });
    })();
  });
</script>
{% endblock %}
